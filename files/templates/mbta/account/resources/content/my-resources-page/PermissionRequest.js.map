{"version":3,"file":"PermissionRequest.js","names":["React","Button","Modal","Text","Badge","DataListItem","DataList","TextVariants","DataListItemRow","DataListItemCells","DataListCell","Chip","Split","SplitItem","ModalVariant","UserCheckIcon","AccountServiceContext","Msg","ContentAlert","PermissionRequest","Component","constructor","props","context","shareRequest","index","handle","username","scopes","resource","shareRequests","splice","approve","id","_id","handleToggleDialog","permissionsRequest","doGet","permissions","data","foundPermission","find","p","userScopes","push","doPut","success","localize","onClose","e","console","error","setState","isOpen","state","render","name","replace","length","large","map","i","firstName","lastName","small","email","scope","j","handleApprove","handleDeny","row"],"sources":["../../../src/app/content/my-resources-page/PermissionRequest.tsx"],"sourcesContent":["/*\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as React from 'react';\nimport {\n    Button,\n    Modal,\n    Text,\n    Badge,\n    DataListItem,\n    DataList,\n    TextVariants,\n    DataListItemRow,\n    DataListItemCells,\n    DataListCell,\n    Chip,\n    Split,\n    SplitItem,\n    ModalVariant\n} from '@patternfly/react-core';\nimport { UserCheckIcon } from '@patternfly/react-icons';\n\nimport { HttpResponse } from '../../account-service/account.service';\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\nimport { Msg } from '../../widgets/Msg';\nimport { ContentAlert } from '../ContentAlert';\nimport { Resource, Scope, Permission, Permissions } from './resource-model';\n\n\ninterface PermissionRequestProps {\n    resource: Resource;\n    onClose: () => void;\n}\n\ninterface PermissionRequestState {\n    isOpen: boolean;\n}\n\nexport class PermissionRequest extends React.Component<PermissionRequestProps, PermissionRequestState> {\n    protected static defaultProps:Permissions = { permissions: [], row: 0 };\n    static contextType = AccountServiceContext;\n    context: React.ContextType<typeof AccountServiceContext>;\n\n    public constructor(props: PermissionRequestProps, context: React.ContextType<typeof AccountServiceContext>) {\n        super(props);\n        this.context = context;\n    \n        this.state = {\n            isOpen: false,\n        };\n    }\n\n    private handleApprove = async (shareRequest: Permission, index: number) => {\n        this.handle(shareRequest.username, shareRequest.scopes as Scope[], true);\n        this.props.resource.shareRequests.splice(index, 1);\n    };\n\n    private handleDeny = async (shareRequest: Permission, index: number) => {\n        this.handle(shareRequest.username, shareRequest.scopes as Scope[]);\n        this.props.resource.shareRequests.splice(index, 1)\n    };\n\n    private handle = async (username: string, scopes: Scope[], approve: boolean = false) => {\n        const id = this.props.resource._id\n        this.handleToggleDialog();\n\n        const permissionsRequest: HttpResponse<Permission[]> = await this.context!.doGet(`/resources/${id}/permissions`);\n        const permissions = permissionsRequest.data || [];\n        const foundPermission = permissions.find(p => p.username === username);\n        const userScopes = foundPermission ? (foundPermission.scopes as Scope[]): [];\n        if (approve) {\n            userScopes.push(...scopes);\n        }\n        try {\n            await this.context!.doPut(`/resources/${id}/permissions`, [{ username: username, scopes: userScopes }] )\n            ContentAlert.success(Msg.localize('shareSuccess'));\n            this.props.onClose();\n        } catch (e) {\n            console.error('Could not update permissions', e.error);\n        }\n    };\n\n    private handleToggleDialog = () => {\n        this.setState({ isOpen: !this.state.isOpen });\n    };\n\n    public render(): React.ReactNode {\n        const id = `shareRequest-${this.props.resource.name.replace(/\\s/, '-')}`;\n        return (\n            <React.Fragment>\n                <Button id={id} variant=\"link\" onClick={this.handleToggleDialog}>\n                    <UserCheckIcon size=\"lg\" />\n                    <Badge>{this.props.resource.shareRequests.length}</Badge>\n                </Button>\n\n                <Modal\n                    id={`modal-${id}`}\n                    title={Msg.localize('permissionRequests') + ' - ' + this.props.resource.name}\n                    variant={ModalVariant.large}\n                    isOpen={this.state.isOpen}\n                    onClose={this.handleToggleDialog}\n                    actions={[\n                        <Button id={`close-${id}`} key=\"close\" variant=\"link\" onClick={this.handleToggleDialog}>\n                            <Msg msgKey=\"close\" />\n                        </Button>,\n                    ]}\n                >\n                    <DataList aria-label={Msg.localize('permissionRequests')}>\n                        <DataListItemRow>\n                            <DataListItemCells\n                                dataListCells={[\n                                    <DataListCell key='permissions-name-header' width={5}>\n                                        <strong>Requestor</strong>\n                                    </DataListCell>,\n                                    <DataListCell key='permissions-requested-header' width={5}>\n                                        <strong><Msg msgKey='permissionRequests' /></strong>\n                                    </DataListCell>,\n                                    <DataListCell key='permission-request-header' width={5}>\n                                    </DataListCell>\n                                ]}\n                            />\n                        </DataListItemRow>\n                        {this.props.resource.shareRequests.map((shareRequest, i) =>\n                            <DataListItem key={i} aria-labelledby=\"requestor\">\n                                <DataListItemRow>\n                                    <DataListItemCells\n                                        dataListCells={[\n                                            <DataListCell id={`requestor${i}`} key={`requestor${i}`}>\n                                                <span>\n                                                    {shareRequest.firstName} {shareRequest.lastName} {shareRequest.lastName ? '' : shareRequest.username}\n                                                </span><br />\n                                                <Text component={TextVariants.small}>{shareRequest.email}</Text>\n                                            </DataListCell>,\n                                            <DataListCell id={`permissions${i}`} key={`permissions${i}`}>\n                                                {(shareRequest.scopes as Scope[]).map((scope, j) => <Chip key={j} isReadOnly>{scope}</Chip>)}\n                                            </DataListCell>,\n                                            <DataListCell key={`actions${i}`}>\n                                                <Split hasGutter>\n                                                    <SplitItem>\n                                                        <Button\n                                                            id={`accept-${i}-${id}`}\n                                                            onClick={() => this.handleApprove(shareRequest, i)}\n                                                        >\n                                                            Accept\n                                                        </Button>\n                                                    </SplitItem>\n                                                    <SplitItem>\n                                                        <Button\n                                                            id={`deny-${i}-${id}`}\n                                                            variant=\"danger\"\n                                                            onClick={() => this.handleDeny(shareRequest, i)}\n                                                        >\n                                                            Deny\n                                                        </Button>\n                                                    </SplitItem>\n                                                </Split>\n                                            </DataListCell>\n                                        ]}\n                                    />\n                                </DataListItemRow>\n                            </DataListItem>\n                        )}\n                    </DataList>\n                </Modal>\n            </React.Fragment>\n        );\n    }\n}\n"],"mappings":"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"}